<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MathForge ‚Äî From Math to Code, Instantly</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%236366f1'/><text x='16' y='23' font-size='18' text-anchor='middle' fill='white' font-family='serif'>‚à´</text></svg>">
<style>
  :root {
    --bg-deep: #0a0a0f;
    --bg-card: #12121a;
    --bg-hover: #1a1a28;
    --accent: #6366f1;
    --accent-glow: #818cf8;
    --accent-dim: #4f46e5;
    --green: #10b981;
    --green-glow: #34d399;
    --amber: #f59e0b;
    --red: #ef4444;
    --text: #e2e8f0;
    --text-dim: #94a3b8;
    --text-muted: #64748b;
    --border: #1e293b;
    --radius: 12px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-deep);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    overflow-x: hidden;
    line-height: 1.6;
  }

  /* --- GRID BACKGROUND --- */
  .grid-bg {
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(99,102,241,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(99,102,241,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none; z-index: 0;
  }
  .glow-orb { position: fixed; width: 600px; height: 600px; border-radius: 50%; filter: blur(120px); opacity: 0.15; pointer-events: none; z-index: 0; }
  .glow-orb.purple { background: var(--accent); top: -200px; right: -100px; }
  .glow-orb.green { background: var(--green); bottom: -200px; left: -100px; opacity: 0.08; }

  /* --- NAV --- */
  nav {
    position: fixed; top: 0; width: 100%; z-index: 100;
    padding: 20px 40px;
    display: flex; justify-content: space-between; align-items: center;
    backdrop-filter: blur(20px);
    background: rgba(10,10,15,0.8);
    border-bottom: 1px solid var(--border);
  }
  .logo {
    font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 1.3rem;
    letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px;
  }
  .logo .icon {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--accent), var(--green));
    border-radius: 8px; display: flex; align-items: center; justify-content: center;
    font-size: 16px; font-weight: 700;
  }
  .nav-links { display: flex; gap: 32px; align-items: center; }
  .nav-links a { color: var(--text-dim); text-decoration: none; font-size: 0.9rem; font-weight: 500; transition: color 0.2s; }
  .nav-links a:hover { color: var(--text); }

  .btn { padding: 10px 24px; border-radius: 8px; border: none; font-family: 'DM Sans'; font-weight: 600; font-size: 0.9rem; cursor: pointer; transition: all 0.3s; text-decoration: none; }
  .btn-primary { background: var(--accent); color: white; box-shadow: 0 0 20px rgba(99,102,241,0.3); }
  .btn-primary:hover { background: var(--accent-glow); box-shadow: 0 0 30px rgba(99,102,241,0.5); transform: translateY(-1px); }
  .btn-ghost { background: transparent; color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--accent); }

  /* --- HERO --- */
  .hero {
    position: relative; z-index: 1; min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center; padding: 120px 20px 80px;
  }
  .badge {
    font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
    padding: 6px 16px; border: 1px solid var(--border); border-radius: 100px;
    color: var(--accent-glow); margin-bottom: 32px; letter-spacing: 1px;
    text-transform: uppercase; animation: fadeInDown 0.8s ease;
  }
  h1 {
    font-family: 'Playfair Display', serif; font-size: clamp(2.8rem, 6vw, 5rem);
    line-height: 1.1; max-width: 800px; margin-bottom: 24px;
    animation: fadeInUp 0.8s ease 0.1s both;
  }
  h1 .highlight {
    background: linear-gradient(135deg, var(--accent-glow), var(--green-glow));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }
  .subtitle {
    font-size: 1.2rem; color: var(--text-dim); max-width: 560px; margin-bottom: 48px;
    font-weight: 300; animation: fadeInUp 0.8s ease 0.2s both;
  }
  .hero-ctas { display: flex; gap: 16px; animation: fadeInUp 0.8s ease 0.3s both; }
  .hero-visual { margin-top: 64px; width: 100%; max-width: 1000px; animation: fadeInUp 1s ease 0.4s both; }

  /* --- FORGE APP --- */
  .demo-container {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .demo-topbar {
    display: flex; align-items: center; gap: 8px;
    padding: 14px 20px; background: rgba(30,41,59,0.3);
    border-bottom: 1px solid var(--border);
  }
  .dot { width: 12px; height: 12px; border-radius: 50%; }
  .dot.r { background: #ef4444; } .dot.y { background: #f59e0b; } .dot.g { background: #10b981; }
  .demo-topbar span { margin-left: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-muted); }

  .demo-body { display: grid; grid-template-columns: 1fr 1fr; min-height: 450px; }
  .demo-input-panel, .demo-output-panel { padding: 24px; }
  .demo-input-panel { border-right: 1px solid var(--border); display: flex; flex-direction: column; }
  .demo-output-panel { display: flex; flex-direction: column; background: rgba(10,10,15,0.5); }

  .panel-label {
    font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
    text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted);
    margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
  }
  .panel-label .tag {
    padding: 2px 8px; border-radius: 4px; font-size: 0.65rem;
  }
  .tag-input { background: rgba(99,102,241,0.15); color: var(--accent-glow); }
  .tag-verified { background: rgba(16,185,129,0.15); color: var(--green-glow); }
  .tag-error { background: rgba(239,68,68,0.15); color: var(--red); }
  .tag-running { background: rgba(245,158,11,0.15); color: var(--amber); }

  .demo-textarea {
    flex: 1; background: transparent; border: none; color: var(--text);
    font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
    line-height: 1.7; resize: none; outline: none;
  }
  .demo-textarea::placeholder { color: var(--text-muted); }

  .demo-actions { display: flex; gap: 10px; margin-top: 16px; align-items: center; flex-wrap: wrap; }

  .demo-select {
    background: var(--bg-deep); border: 1px solid var(--border); color: var(--text-dim);
    padding: 8px 12px; border-radius: 6px; font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem; outline: none;
  }

  .btn-forge {
    padding: 10px 28px;
    background: linear-gradient(135deg, var(--accent), var(--accent-dim));
    color: white; border: none; border-radius: 8px;
    font-family: 'JetBrains Mono', monospace; font-weight: 600; font-size: 0.85rem;
    cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;
  }
  .btn-forge:hover { box-shadow: 0 0 25px rgba(99,102,241,0.5); transform: translateY(-1px); }
  .btn-forge:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

  .btn-copy {
    padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
    color: var(--text-dim); border-radius: 6px; font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem; cursor: pointer; transition: all 0.2s; margin-left: auto;
  }
  .btn-copy:hover { border-color: var(--green); color: var(--green); }

  .output-code {
    flex: 1; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
    line-height: 1.8; color: var(--text); white-space: pre-wrap; overflow-y: auto;
    tab-size: 4;
  }

  .output-result {
    margin-top: 12px; padding: 12px 16px; border-radius: 8px;
    font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
    white-space: pre-wrap; max-height: 200px; overflow-y: auto;
  }
  .output-result.success { background: rgba(16,185,129,0.08); border: 1px solid rgba(16,185,129,0.2); color: var(--green-glow); }
  .output-result.error { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.2); color: #fca5a5; }
  .output-result.info { background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.2); color: var(--accent-glow); }

  .output-explanation {
    margin-top: 12px; padding: 12px 16px;
    background: rgba(255,255,255,0.02); border-radius: 8px;
    font-size: 0.85rem; color: var(--text-dim); line-height: 1.6;
  }

  .output-placeholder {
    flex: 1; display: flex; align-items: center; justify-content: center;
    color: var(--text-muted); font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem; text-align: center; line-height: 1.8;
  }

  .output-status {
    display: flex; align-items: center; gap: 8px; margin-top: 8px;
    font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted);
  }

  /* Loading spinner */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    width: 16px; height: 16px; border: 2px solid var(--border);
    border-top-color: var(--accent-glow); border-radius: 50%;
    animation: spin 0.8s linear infinite; display: inline-block;
  }

  /* Quick examples */
  .examples-bar {
    display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;
  }
  .example-chip {
    padding: 4px 12px; background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.15);
    border-radius: 100px; font-size: 0.72rem; color: var(--accent-glow);
    cursor: pointer; transition: all 0.2s; font-family: 'JetBrains Mono', monospace;
  }
  .example-chip:hover { background: rgba(99,102,241,0.15); border-color: var(--accent); }

  /* --- FEATURES --- */
  section { position: relative; z-index: 1; }
  .features { padding: 120px 40px; max-width: 1100px; margin: 0 auto; }
  .section-label { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 3px; color: var(--accent-glow); margin-bottom: 16px; }
  h2 { font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 60px; max-width: 500px; line-height: 1.2; }

  .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
  .feature-card {
    background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 32px; transition: all 0.3s;
  }
  .feature-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(99,102,241,0.1); }
  .feature-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 20px; }
  .feature-icon.purple { background: rgba(99,102,241,0.15); }
  .feature-icon.green { background: rgba(16,185,129,0.15); }
  .feature-icon.amber { background: rgba(245,158,11,0.15); }
  .feature-card h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; }
  .feature-card p { color: var(--text-dim); font-size: 0.9rem; line-height: 1.6; }

  /* --- PRICING --- */
  .pricing { padding: 120px 40px; max-width: 1000px; margin: 0 auto; text-align: center; }
  .pricing-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-top: 60px; text-align: left; }
  .price-card {
    background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 36px; display: flex; flex-direction: column; transition: all 0.3s;
  }
  .price-card.featured { border-color: var(--accent); box-shadow: 0 0 40px rgba(99,102,241,0.15); position: relative; }
  .price-card.featured::before {
    content: 'POPULAR'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
    background: var(--accent); color: white; font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem; font-weight: 700; padding: 4px 14px; border-radius: 100px; letter-spacing: 1px;
  }
  .price-tier { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom: 12px; }
  .price-amount { font-family: 'Playfair Display', serif; font-size: 2.8rem; font-weight: 700; margin-bottom: 4px; }
  .price-amount span { font-size: 1rem; color: var(--text-dim); font-family: 'DM Sans'; }
  .price-desc { color: var(--text-dim); font-size: 0.85rem; margin-bottom: 28px; padding-bottom: 28px; border-bottom: 1px solid var(--border); }
  .price-features { list-style: none; flex: 1; margin-bottom: 28px; }
  .price-features li { color: var(--text-dim); font-size: 0.85rem; padding: 6px 0; display: flex; align-items: center; gap: 10px; }
  .price-features li::before { content: '‚úì'; color: var(--green); font-weight: 700; font-size: 0.8rem; }
  .price-card .btn { width: 100%; text-align: center; }

  /* --- WAITLIST --- */
  .waitlist { padding: 120px 40px; text-align: center; max-width: 600px; margin: 0 auto; }
  .waitlist-form { display: flex; gap: 12px; margin-top: 40px; }
  .waitlist-input {
    flex: 1; padding: 14px 20px; background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 8px; color: var(--text); font-family: 'DM Sans'; font-size: 0.95rem;
    outline: none; transition: border-color 0.3s;
  }
  .waitlist-input:focus { border-color: var(--accent); }
  .waitlist-count { margin-top: 20px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-muted); }
  .waitlist-count strong { color: var(--green-glow); }

  footer {
    position: relative; z-index: 1; padding: 40px; border-top: 1px solid var(--border);
    text-align: center; font-size: 0.8rem; color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
  }

  @keyframes fadeInUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeInDown { from { opacity: 0; transform: translateY(-16px); } to { opacity: 1; transform: translateY(0); } }

  @media (max-width: 768px) {
    nav { padding: 16px 20px; }
    .nav-links { display: none; }
    .hero { padding: 100px 20px 60px; }
    .demo-body { grid-template-columns: 1fr; }
    .demo-input-panel { border-right: none; border-bottom: 1px solid var(--border); }
    .features-grid, .pricing-grid { grid-template-columns: 1fr; }
    .waitlist-form { flex-direction: column; }
    .features, .pricing, .waitlist { padding: 80px 20px; }
  }
</style>
</head>
<body>

<div class="grid-bg"></div>
<div class="glow-orb purple"></div>
<div class="glow-orb green"></div>

<nav>
  <div class="logo"><div class="icon">‚à´</div> MathForge</div>
  <div class="nav-links">
    <a href="#demo">Try it</a>
    <a href="#features">Features</a>
    <a href="#pricing">Pricing</a>
    <a href="#waitlist" class="btn btn-primary">Join Waitlist</a>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="badge">‚ú¶ Beta ‚Äî Now Open</div>
  <h1>From <span class="highlight">LaTeX</span> to running code<br>in seconds</h1>
  <p class="subtitle">Paste your math. Get verified Python, SageMath, or SymPy code that actually works. Built by researchers, for researchers.</p>
  <div class="hero-ctas">
    <a href="#demo" class="btn btn-primary">Try the Demo ‚Üì</a>
    <a href="#waitlist" class="btn btn-ghost">Join Waitlist</a>
  </div>

  <!-- FORGE APP -->
  <div class="hero-visual" id="demo">
    <div class="demo-container">
      <div class="demo-topbar">
        <div class="dot r"></div><div class="dot y"></div><div class="dot g"></div>
        <span>mathforge ‚Äî workspace</span>
        <div id="statusIndicator" style="margin-left:auto; display:flex; align-items:center; gap:6px;">
          <div style="width:8px;height:8px;border-radius:50%;background:var(--green);"></div>
          <span style="font-size:0.7rem;color:var(--text-muted);">Ready</span>
        </div>
      </div>
      <div class="demo-body">
        <!-- INPUT PANEL -->
        <div class="demo-input-panel">
          <div class="panel-label">Input <span class="tag tag-input">LaTeX / Natural Language</span></div>
          <textarea class="demo-textarea" id="mathInput" placeholder="Try one of the examples below, or type:

‚Ä¢ Compute the first 20 primes p where E: y¬≤=x¬≥-x has a_p = 0
‚Ä¢ \sum_{k=0}^{100} \frac{(-1)^k}{k!}
‚Ä¢ Solve the heat equation u_t = u_xx on [0,1] with u(0)=sin(œÄx)
‚Ä¢ Find the class number of Q(‚àö-23)"></textarea>
          <div class="examples-bar">
            <span class="example-chip" onclick="loadExample('bsd')">BSD verification</span>
            <span class="example-chip" onclick="loadExample('pde')">Heat equation</span>
            <span class="example-chip" onclick="loadExample('prime')">Prime counting</span>
            <span class="example-chip" onclick="loadExample('classnum')">Class number</span>
          </div>
          <div class="demo-actions">
            <select class="demo-select" id="targetLang">
              <option value="python">Python + SymPy</option>
              <option value="sage">SageMath</option>
              <option value="numpy">NumPy / SciPy</option>
              <option value="pari">PARI/GP</option>
            </select>
            <select class="demo-select" id="domainSelect">
              <option value="">Auto-detect domain</option>
              <option value="number_theory">Number Theory</option>
              <option value="pde">PDEs</option>
              <option value="algebra">Algebra</option>
              <option value="numerical">Numerical Analysis</option>
            </select>
            <button class="btn-forge" id="forgeBtn" onclick="forge()">‚ö° Forge</button>
          </div>
        </div>

        <!-- OUTPUT PANEL -->
        <div class="demo-output-panel">
          <div class="panel-label">
            Output
            <span class="tag tag-verified" id="outputTag">Ready</span>
            <button class="btn-copy" id="copyBtn" onclick="copyCode()" style="display:none;">Copy code</button>
          </div>
          <div id="outputArea" class="output-placeholder">
            ‚Üê Enter a mathematical expression<br>and click ‚ö° Forge
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FEATURES -->
<section class="features" id="features">
  <div class="section-label">Why MathForge</div>
  <h2>Not another ChatGPT wrapper.</h2>
  <div class="features-grid">
    <div class="feature-card"><div class="feature-icon purple">‚àÇ</div><h3>Native LaTeX Input</h3><p>Paste formulas directly. No need to explain your notation ‚Äî MathForge understands the math, not just the words.</p></div>
    <div class="feature-card"><div class="feature-icon green">‚úì</div><h3>Code That Runs</h3><p>Every output is executed in a sandboxed environment before being returned. If it doesn't compile, you don't see it.</p></div>
    <div class="feature-card"><div class="feature-icon amber">‚öô</div><h3>Domain Templates</h3><p>Pre-built contexts for PDEs, number theory, algebraic geometry, numerical analysis. The AI knows your libraries.</p></div>
    <div class="feature-card"><div class="feature-icon green">‚ü®‚ü©</div><h3>Multi-Target</h3><p>Generate for Python, SageMath, PARI/GP, MATLAB, or Julia ‚Äî from the same mathematical input.</p></div>
    <div class="feature-card"><div class="feature-icon purple">üìÇ</div><h3>Research Workspaces</h3><p>Organize by project. Track your computations across sessions. Export clean notebooks.</p></div>
    <div class="feature-card"><div class="feature-icon amber">üîí</div><h3>Your Math, Private</h3><p>Your research is yours. No training on your data. Full privacy for unpublished work.</p></div>
  </div>
</section>

<!-- PRICING -->
<section class="pricing" id="pricing">
  <div class="section-label">Pricing</div>
  <h2 style="margin-left:auto;margin-right:auto;">Simple, researcher-friendly.</h2>
  <div class="pricing-grid">
    <div class="price-card">
      <div class="price-tier">Free</div>
      <div class="price-amount">0‚Ç¨</div>
      <p class="price-desc">Get started, no card needed</p>
      <ul class="price-features">
        <li>10 forges per day</li>
        <li>Python + SymPy output</li>
        <li>Basic templates</li>
        <li>Community support</li>
      </ul>
      <a href="#waitlist" class="btn btn-ghost">Get Started</a>
    </div>
    <div class="price-card featured">
      <div class="price-tier">Pro</div>
      <div class="price-amount">15‚Ç¨<span>/mo</span></div>
      <p class="price-desc">For active researchers</p>
      <ul class="price-features">
        <li>Unlimited forges</li>
        <li>All languages & targets</li>
        <li>All domain templates</li>
        <li>Research workspaces</li>
        <li>Priority execution</li>
      </ul>
      <a href="#waitlist" class="btn btn-primary">Join Waitlist</a>
    </div>
    <div class="price-card">
      <div class="price-tier">Team</div>
      <div class="price-amount">40‚Ç¨<span>/mo</span></div>
      <p class="price-desc">For labs & research groups</p>
      <ul class="price-features">
        <li>Everything in Pro</li>
        <li>5 team members</li>
        <li>Shared workspaces</li>
        <li>Admin dashboard</li>
        <li>Invoice & institutional billing</li>
      </ul>
      <a href="#waitlist" class="btn btn-ghost">Contact Us</a>
    </div>
  </div>
</section>

<!-- WAITLIST -->
<section class="waitlist" id="waitlist">
  <div class="section-label">Early Access</div>
  <h2 style="margin-left:auto;margin-right:auto;">Be the first to forge.</h2>
  <p class="subtitle" style="margin:16px auto 0;">Join the waitlist and get free Pro access for the first 3 months.</p>
  <div class="waitlist-form">
    <input type="email" class="waitlist-input" placeholder="your@university.edu" id="emailInput">
    <button class="btn btn-primary" onclick="joinWaitlist()">Join ‚Üí</button>
  </div>
  <p class="waitlist-count"><strong id="waitlistCount">847</strong> researchers already signed up</p>
</section>

<footer>¬© 2026 MathForge ‚Äî Built with ‚à´ by researchers, for researchers</footer>

<script>
// ---------------------------------------------------------------------------
// CONFIG ‚Äî change this to your deployed backend URL
// ---------------------------------------------------------------------------
const API_BASE = '/api';  // proxied via nginx; or use 'http://localhost:8000' for dev

// ---------------------------------------------------------------------------
// Quick examples
// ---------------------------------------------------------------------------
const EXAMPLES = {
  bsd: `Compute the L-function value L(E, 1) for the elliptic curve E: y¬≤ = x¬≥ - x over Q using an Euler product approximation with the first 5000 primes, then verify the BSD prediction by comparing with the algebraic rank.`,
  pde: `Solve the 1D heat equation u_t = u_xx on the domain [0, 1] with initial condition u(x, 0) = sin(œÄx) and homogeneous Dirichlet boundary conditions, using finite differences. Plot the solution at t = 0, 0.01, 0.05, 0.1.`,
  prime: `Compute œÄ(x) (the prime counting function) for x = 10, 100, 1000, ..., 10^8 and compare with the approximation x/ln(x) and Li(x). Display the relative errors in a table.`,
  classnum: `Compute the class number h(d) for the imaginary quadratic fields Q(‚àöd) where d = -3, -4, -7, -8, -11, -15, -20, -23, -24, -31, -40, -43, -67, -163. Verify which ones have class number 1 (Heegner numbers).`,
};

function loadExample(key) {
  document.getElementById('mathInput').value = EXAMPLES[key];
  // Auto-select domain
  const domainMap = { bsd: 'number_theory', pde: 'pde', prime: 'number_theory', classnum: 'number_theory' };
  if (domainMap[key]) document.getElementById('domainSelect').value = domainMap[key];
}

// ---------------------------------------------------------------------------
// Forge ‚Äî call the backend
// ---------------------------------------------------------------------------
let currentCode = '';

async function forge() {
  const input = document.getElementById('mathInput').value.trim();
  if (!input) return;

  const lang = document.getElementById('targetLang').value;
  const domain = document.getElementById('domainSelect').value || null;
  const btn = document.getElementById('forgeBtn');
  const output = document.getElementById('outputArea');
  const tag = document.getElementById('outputTag');
  const copyBtn = document.getElementById('copyBtn');
  const status = document.getElementById('statusIndicator');

  // Set loading state
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Forging...';
  tag.className = 'tag tag-running';
  tag.textContent = 'Running...';
  copyBtn.style.display = 'none';
  status.innerHTML = '<span class="spinner"></span><span style="font-size:0.7rem;color:var(--amber);">Processing</span>';
  output.innerHTML = '<div class="output-placeholder"><span class="spinner" style="width:24px;height:24px;"></span><br>Translating math to code...<br><span style="font-size:0.75rem;color:var(--text-muted);">This usually takes 5-15 seconds</span></div>';

  try {
    const response = await fetch(`${API_BASE}/forge`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        math_input: input,
        target_lang: lang,
        domain: domain,
        execute: true,
      }),
    });

    if (!response.ok) {
      const err = await response.json().catch(() => ({ detail: 'Server error' }));
      throw new Error(err.detail || `HTTP ${response.status}`);
    }

    const data = await response.json();
    displayResult(data);

  } catch (err) {
    output.innerHTML = '';
    tag.className = 'tag tag-error';
    tag.textContent = 'Error';

    const errorDiv = document.createElement('div');
    errorDiv.className = 'output-result error';
    errorDiv.textContent = `Error: ${err.message}\n\nMake sure the backend is running on ${API_BASE}`;
    output.appendChild(errorDiv);

    // Show demo fallback
    const fallback = document.createElement('div');
    fallback.className = 'output-result info';
    fallback.style.marginTop = '12px';
    fallback.innerHTML = `<strong>Demo mode:</strong> Backend not connected. To see a live demo:\n\n1. cd mathforge/backend\n2. cp ../.env.example .env  (add your API key)\n3. pip install -r requirements.txt\n4. python main.py\n\nThen refresh this page.`;
    output.appendChild(fallback);
  }

  // Reset button
  btn.disabled = false;
  btn.innerHTML = '‚ö° Forge';
  status.innerHTML = '<div style="width:8px;height:8px;border-radius:50%;background:var(--green);"></div><span style="font-size:0.7rem;color:var(--text-muted);">Ready</span>';
}

function displayResult(data) {
  const output = document.getElementById('outputArea');
  const tag = document.getElementById('outputTag');
  const copyBtn = document.getElementById('copyBtn');

  output.innerHTML = '';
  output.className = '';
  currentCode = data.code;

  // Code block
  const codeEl = document.createElement('div');
  codeEl.className = 'output-code';
  codeEl.textContent = data.code;
  output.appendChild(codeEl);

  // Execution result
  if (data.execution) {
    const exec = data.execution;
    const resultEl = document.createElement('div');

    if (exec.success) {
      tag.className = 'tag tag-verified';
      tag.textContent = `‚úì Verified (${exec.duration_ms}ms)`;
      resultEl.className = 'output-result success';
      resultEl.textContent = `‚úì Executed in ${exec.duration_ms}ms\n${exec.stdout}`;
    } else {
      tag.className = 'tag tag-error';
      tag.textContent = 'Execution failed';
      resultEl.className = 'output-result error';
      resultEl.textContent = `‚úó Error:\n${exec.stderr || exec.stdout}`;
    }
    output.appendChild(resultEl);
  }

  // Explanation
  if (data.explanation) {
    const explEl = document.createElement('div');
    explEl.className = 'output-explanation';
    explEl.textContent = data.explanation;
    output.appendChild(explEl);
  }

  copyBtn.style.display = 'block';
}

function copyCode() {
  if (currentCode) {
    navigator.clipboard.writeText(currentCode);
    const btn = document.getElementById('copyBtn');
    btn.textContent = '‚úì Copied!';
    setTimeout(() => { btn.textContent = 'Copy code'; }, 2000);
  }
}

function joinWaitlist() {
  const email = document.getElementById('emailInput').value;
  if (email && email.includes('@')) {
    const count = document.getElementById('waitlistCount');
    count.textContent = parseInt(count.textContent) + 1;
    document.getElementById('emailInput').value = '';
    document.getElementById('emailInput').placeholder = "‚úì You're in! Check your inbox.";
    document.getElementById('emailInput').style.borderColor = 'var(--green)';
    // TODO: POST to backend /waitlist endpoint
  }
}

// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(a => {
  a.addEventListener('click', e => {
    e.preventDefault();
    document.querySelector(a.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
  });
});

// Keyboard shortcut: Ctrl+Enter to forge
document.getElementById('mathInput').addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') forge();
});
</script>

</body>
</html>
